---
title: "R Notebook"
output: html_notebook
---
## Práctico 2

Usando *ggplot2*, vamos a seguir jugando con gapminder. Esta vez, vamos a explorar la relación entre la tasa de fertilidad, la expectativa de vida y el tamaño de la población. 

Primero, importamos las librerías `ggplot` y `dplyr`. También, vamos a leer el archivo `gapminder_clean.csv` que está en la carpeta `data`. 

```{r}
library(ggplot2)
library(dplyr)
library(readr)

df <- read_csv('./data/clean_gapminder.csv')
```


## Ejercicio 1

Realizá un gráfico que muestre la relación entre la tasa de fertilidad y la expectativa de vida en el año 2007 para todos los países. 

```{r}
ggplot(filter(df, year == 2007), aes(x=fert, y=life))+
  geom_point()
```

## Ejercicio 2

Introducí en el gráfico las variables de `continent` y `pop` (tamaño de la población). Pensá: ¿qué atributos estéticos puedo utilizar para mostrar los valores según el tipo de variable? Luego ploteá un gráfico de muestra.

```{r}
ggplot(filter(df, year == 2007), aes(x = fert, y = life, color = continent, size = pop))+
  geom_point()
```

Si quisiera hacer que los puntos se vean más grandes proporcionalmente y controlar las escalas de corte de la población, hago lo siguiente: 

```{r}
ggplot(filter(df, year == 2007), aes(x = fert, y = life, color = continent, size = pop))+
  geom_point()+ 
  scale_size(range=c(2,8), #Indico en el rango de píxeles que quiero que crezcan
             breaks=c(250,500,750,1000,1250), #Cortes que le hace a la variable continua
             labels=c("250","500","750","1000","1250"), #Indico las etiquetas que van a estar mostradas en la escala de pob
             name = "población") 

```

## Ejercicio 3

Modificá manualmente los colores de los continentes. Queremos que Europa tenga el tono "darkorange", Asia "red", África "blue", las Américas "yellow" y Oceanía "purple". 

```{r}
color_continentes <- c( "Europe" = "darkorange", "Asia" = "red", "Africa" = "blue", "Americas" = "yellow", "Oceania" = "purple") 

ggplot(filter(df, year == 2007), aes(x = fert, y= life, color = continent, size = pop))+
  geom_point()+
  scale_color_manual(values = color_continentes)
```
Si quisiera agregar una etiqueta en algunos puntos, indicando cual es el país con mayor cantidad de población y cual es el país con menor cantidad tengo que hacer varias cosas. Primero, me fijo cuáles son dichos países.

```{r}
#Más grande:
df %>% group_by(country) %>% 
  filter(year == 2007) %>%
  arrange(desc(pop))
  
#Más chico
df %>% group_by(country) %>% 
  filter(year == 2007) %>%
  arrange(pop)
```

Una forma de resolverlo, que vimos en clase, es con la función `annotate()`. Le tengo que pasar las coordenadas de x e y de dónde hacer la anotación.

```{r}
ggplot(filter(df, year == 2007), aes(x = fert, y= life, color = continent, size = pop))+
  geom_point()+
  scale_color_manual(values = color_continentes)+
  annotate('text',x = 1.53, y = 73.10, label = 'China')+ #Agrego pob más grande
  annotate('text', x = 4.46, y = 65.70, label = 'Sao Tome and Principe') #Agrego pob más chica
```
Y frente a esto me imagino que se abre la pregunta, ¿cómo agrego una etiqueta a todos los puntitos del gráfico? Esto es bastante más simple. Como agregar una etiqueta a todos los países que aparecen en nuestro gráfico de arriba quedaría bastante ilegible, lo vamos a hacer para un gráfico que muestre las tasas de fertilidad y expectativa de vida medias de todos los continentes usando la función `geom_text()`.

```{r}
df %>% 
  filter(year == 2007) %>%
  group_by(continent) %>%
  summarise(mean_life = mean(life),
            mean_fert = mean(fert),
            pop = max(pop)) %>%
  ggplot(aes(x = mean_fert, y= mean_life, size = pop))+
    geom_point()+
    scale_color_manual()+
    geom_text(aes(label=continent), #Le paso como parámetro estético que la etiqueta sean los valores de la columna "continent"
              hjust=0.5, #Le indico que mueva las etiquetas 0,5 píxeles a la izquierda
              vjust=2) #Le indico que mueva las etiquetas 2 píxeles hacia abajo
```


## Ejercicio 4

Realizá limpieza y ordenamiento finales, asegurate de que las labels describan debidamente su elemento asignado. 

```{r}
#Pruebo cambiar el tema con theme_minimal()
ggplot(filter(df, year == 2007), aes(x = fert, y= life, color = continent, size = pop))+
  geom_point()+
  scale_color_manual(values = color_continentes)+
  labs(title = "Expectativa de vida y fertilidad",
       subtitle = "según datos 2007",
       caption = "Fuente: Gapminder",
       size = "Población (en millones)",
       color = "Continente",
       x = "Tasa de fertilidad",
       y = "Expectativa de vida")+
  theme_minimal()

#Pruebo cambiar el tema con alguno de la librería ggthemes
library(ggthemes)

ggplot(filter(df, year == 2007), aes(x = fert, y= life, color = continent, size = pop))+
  geom_point()+
  scale_color_manual(values = color_continentes)+
  labs(title = "Expectativa de vida y fertilidad",
       subtitle = "según datos 2007",
       caption = "Fuente: Gapminder",
       size = "Población (en millones)",
       color = "Continente",
       x = "Tasa de fertilidad",
       y = "Expectativa de vida")+
  theme_tufte()

```

